<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Entities and Slots - Eevee</title> <link rel="shortcut icon" href="/eevee/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/eevee/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/eevee/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/eevee/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Entities and Slots | Eevee</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="Entities and Slots" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Evaluation utilities" /> <meta property="og:description" content="Evaluation utilities" /> <link rel="canonical" href="/eevee/metrics/slots.html" /> <meta property="og:url" content="/eevee/metrics/slots.html" /> <meta property="og:site_name" content="Eevee" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Entities and Slots" /> <script type="application/ld+json"> {"description":"Evaluation utilities","url":"/eevee/metrics/slots.html","@type":"WebPage","headline":"Entities and Slots","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/eevee/" class="site-title lh-tight"> Eevee </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/eevee/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/eevee/data-structures.html" class="nav-list-link">Data Structures</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/eevee/metrics/" class="nav-list-link">Metrics</a><ul class="nav-list "><li class="nav-list-item "><a href="/eevee/metrics/intents.html" class="nav-list-link">Intents</a></li><li class="nav-list-item active"><a href="/eevee/metrics/slots.html" class="nav-list-link active">Entities and Slots</a></li><li class="nav-list-item "><a href="/eevee/metrics/asr.html" class="nav-list-link">Speech Recognition</a></li></ul></li><li class="nav-list-item"><a href="/eevee/roadmap.html" class="nav-list-link">Roadmap</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Eevee" aria-label="Search Eevee" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/eevee/metrics/">Metrics</a></li> <li class="breadcrumb-nav-list-item"><span>Entities and Slots</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <p>Refer to <a href="https://github.com/skit-ai/onboarding/blob/master/ml/slot-reporting/slot-evaluation-and-reporting.ipynb">this</a> document to understand more about slots, entities, and their metrics.</p> <h1 id="slots"> <a href="#slots" class="anchor-heading" aria-labelledby="slots"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Slots </h1> <p><code class="language-plaintext highlighter-rouge">TODO</code></p> <h1 id="entities"> <a href="#entities" class="anchor-heading" aria-labelledby="entities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Entities </h1> <p>Eevee let’s you calculate all the important <em>turn level metrics</em> for various entities. We tag these data points using tog’s, an internal tool, region tagging method.</p> <div class="table-wrapper"><table> <thead> <tr> <th>Metric</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>False Negative Rate (FNR)</td> <td>Ratio of turns where we missed out predicting an entity while the utterance had it.</td> </tr> <tr> <td>False Positive Rate (FPR)</td> <td>Ratio of turns where we predicted an entity while the utterance didn’t have it. This usually needs attention in normalization by clearly defining what all states are going to be sampled for evaluation.</td> </tr> <tr> <td>Mismatch Rate (MMR)</td> <td>Within entity predictions, the ratio of cases that are differing in value. For example we predicted ‘3’ instead of ‘2’ for a <code class="language-plaintext highlighter-rouge">number</code> entity.</td> </tr> </tbody> </table></div> <p>Here is the list of entities that are supported:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Type</th> <th>Support remarks</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">datetime</code>, <code class="language-plaintext highlighter-rouge">date</code>, <code class="language-plaintext highlighter-rouge">time</code></td> <td>internally <code class="language-plaintext highlighter-rouge">datetime</code> (given) is broken down to <code class="language-plaintext highlighter-rouge">date</code> and <code class="language-plaintext highlighter-rouge">time</code>, therefore false positives, false negatives, true positives are considered along <code class="language-plaintext highlighter-rouge">date</code> &amp; <code class="language-plaintext highlighter-rouge">time</code> and reported outside.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">pattern</code></td> <td>not yet supported</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">number</code></td> <td>supported superficially only. <code class="language-plaintext highlighter-rouge">number</code> and <code class="language-plaintext highlighter-rouge">people</code> are supported interchangeably at this point.</td> </tr> </tbody> </table></div> <h2 id="data-schema"> <a href="#data-schema" class="anchor-heading" aria-labelledby="data-schema"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data schema </h2> <p>either <code class="language-plaintext highlighter-rouge">true-labels.csv</code> or <code class="language-plaintext highlighter-rouge">pred-labels.csv</code> should have rows like these:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id, entities
1, '[{"type": "date", "values": [{"value": "2019-04-21T00:00:00+05:30", "type": "value"}]}]'
2, '[{"text": "6th evening", "type": "time", "values": [{"type": "interval", "value": {"from": "2021-08-06T18:00:00.000-07:00", "to": "2021-08-07T00:00:00.000-07:00"}}]}]'
3, 
4, '[{"text": "67", "type": "number", "values": [{"type": "value", "value": 67}]}]'
5, '[{"text": "want credit card", "type": "product_kind", "values": [{"type": "categorical", "value": "credit_card"}]}]'
</code></pre></div></div> <p>the <code class="language-plaintext highlighter-rouge">entities</code> are in <code class="language-plaintext highlighter-rouge">JSON</code> format.</p> <p>exact schema of entity looks like this:</p> <p>for ordinary <code class="language-plaintext highlighter-rouge">value</code> or <code class="language-plaintext highlighter-rouge">categorical</code> types:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[
    {
        "type": "entity_type", # date, time, datetime, number, people, product_kind, etc...
        "values": [
            {
                "value": "entity_value", # "2019-04-21T00:00:00+05:30", 42, credit_card, etc
                "type": "entity_value_type", # "type" or "categorical"
            }
        ]
    }
]
</code></pre></div></div> <p>for <code class="language-plaintext highlighter-rouge">interval</code> value type:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[
    {
        "type": "entity_type", # date, time, datetime only
        "values": [
            {
                "value": {"from": "...", "to": "..."},
                "type": "interval",
            }
        ]
    }
]
</code></pre></div></div> <p>Three important things to note:</p> <ul> <li>we require only entity’s <code class="language-plaintext highlighter-rouge">type</code>, <code class="language-plaintext highlighter-rouge">values</code> for calculating the <code class="language-plaintext highlighter-rouge">entity_report</code>, the <code class="language-plaintext highlighter-rouge">body</code> / <code class="language-plaintext highlighter-rouge">text</code> or any other key is not required as of now.</li> <li>if no-prediction / no-annotation has been made for that particular entity leave it blank, pandas will parse it as <code class="language-plaintext highlighter-rouge">NaN</code>, accordingly it’ll be processed as false negative / false positive.</li> <li>Right now, we only support only one <code class="language-plaintext highlighter-rouge">value</code>, meaning we compare truth and prediction only on the first duckling prediction. Implies our comparisons right now for entities looks likes: <code class="language-plaintext highlighter-rouge">[{}]</code> vs <code class="language-plaintext highlighter-rouge">[{}]</code>, in future we’d be supporting <code class="language-plaintext highlighter-rouge">[{}, {}]</code> vs <code class="language-plaintext highlighter-rouge">[{}, {}, {}, {}, {}]</code></li> </ul> <h2 id="usage"> <a href="#usage" class="anchor-heading" aria-labelledby="usage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Usage </h2> <h3 id="command-line"> <a href="#command-line" class="anchor-heading" aria-labelledby="command-line"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Command Line </h3> <p>For using it on command line, simply call the sub-command <code class="language-plaintext highlighter-rouge">entity</code> like shown below:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> eevee entity ./true-labels.csv ./pred-labels.csv
</code></pre></div></div> <p>on standard entities like <code class="language-plaintext highlighter-rouge">date</code>, <code class="language-plaintext highlighter-rouge">time</code>, <code class="language-plaintext highlighter-rouge">datetime</code>, <code class="language-plaintext highlighter-rouge">number</code> etc ..</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>               FPR      FNR  Mismatch Rate  Support  Negatives
Entity                                                        
duration  0.004854  0.00000       0.000000        0        618
number    0.070033  0.00000       0.500000        4        614
ordinal   0.006515  1.00000       0.000000        4        614
time      0.016822  0.13253       0.055556       83        535
</code></pre></div></div> <p>on categorical custom entities from clients …</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                   FPR       FNR  Mismatch Rate  Support  Negatives
Entity                                                             
actions       0.004848  0.294118       0.000000       17      14025
form_type     0.000997  0.500000       0.000000        6      14036
language      0.001567  0.000000       0.000000        0      14042
method_type   0.000071  1.000000       0.000000        8      14034
product_kind  0.041297  0.141987       0.076258     3775      10267
</code></pre></div></div> <p>only on categorical entities we can get extra <code class="language-plaintext highlighter-rouge">breakdown</code> (pass <code class="language-plaintext highlighter-rouge">--breakdown</code> flag), which will report entity mismatches on their categorical values, example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ eevee entity data/cat_tog999.tagged.entities.csv data/cat_tog999.predicted.entities.csv --breakdown

                             precision    recall  f1-score  support
Categorical Entity                                                 
_                             0.949898  0.952032  0.950964    10236
actions/change                0.063492  0.666667  0.115942        6
actions/increase              0.470588  0.727273  0.571429       11
form_type/form                0.125000  0.500000  0.200000        4
form_type/request_form        1.000000  0.500000  0.666667        2
method_type/digital_payment   0.000000  0.000000  0.000000        8
product_kind/bank_account     0.797897  0.868957  0.831912      786
product_kind/card             0.240000  0.821918  0.371517       73
product_kind/cheque_book      0.848485  0.823529  0.835821       34
product_kind/credit_card      0.915548  0.797370  0.852382     2053
product_kind/debit_card       0.877686  0.713710  0.787250      744
product_kind/imps             1.000000  1.000000  1.000000        1
product_kind/mobile_banking   0.444444  0.571429  0.500000        7
product_kind/neft             1.000000  0.333333  0.500000        3
product_kind/net_banking      0.311828  0.725000  0.436090       40
product_kind/upi              0.857143  0.529412  0.654545       34
</code></pre></div></div> <p>where <code class="language-plaintext highlighter-rouge">_</code> represents <code class="language-plaintext highlighter-rouge">NaN</code> vs <code class="language-plaintext highlighter-rouge">NaN</code> comparisons. this helps with understanding when it comes to misfiring on no-entities.</p> <h3 id="python-module"> <a href="#python-module" class="anchor-heading" aria-labelledby="python-module"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Python module </h3> <p>A common usage pattern for ML modeling is to use entity comparison functions from <code class="language-plaintext highlighter-rouge">eevee.ord.entity</code> module.</p> <p>A demonstration on how to use <code class="language-plaintext highlighter-rouge">date_eq</code> and <code class="language-plaintext highlighter-rouge">time_eq</code>:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">eevee.ord.entity.datetime</span> <span class="kn">import</span> <span class="n">date_eq</span><span class="p">,</span> <span class="n">time_eq</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">true_date</span> <span class="o">=</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'date'</span><span class="p">,</span> <span class="s">'values'</span><span class="p">:</span> <span class="p">[{</span><span class="s">'value'</span><span class="p">:</span> <span class="s">'2019-04-21T00:00:00+05:30'</span><span class="p">,</span> <span class="s">'type'</span><span class="p">:</span> <span class="s">'value'</span><span class="p">}]}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pred_date</span> <span class="o">=</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'date'</span><span class="p">,</span> <span class="s">'values'</span><span class="p">:</span> <span class="p">[{</span><span class="s">'value'</span><span class="p">:</span> <span class="s">'2019-04-21T00:00:00+05:30'</span><span class="p">,</span> <span class="s">'type'</span><span class="p">:</span> <span class="s">'value'</span><span class="p">}]}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">date_eq</span><span class="p">(</span><span class="n">true_date</span><span class="p">,</span> <span class="n">pred_date</span><span class="p">)</span>
<span class="bp">True</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">true_time</span> <span class="o">=</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'time'</span><span class="p">,</span> <span class="s">'values'</span><span class="p">:</span> <span class="p">[{</span><span class="s">'value'</span><span class="p">:</span> <span class="s">'2019-04-21T09:00:00+05:30'</span><span class="p">,</span> <span class="s">'type'</span><span class="p">:</span> <span class="s">'value'</span><span class="p">}]}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pred_time</span> <span class="o">=</span> <span class="p">{</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'time'</span><span class="p">,</span> <span class="s">'values'</span><span class="p">:</span> <span class="p">[{</span><span class="s">'value'</span><span class="p">:</span> <span class="s">'2019-04-21T00:00:00+05:30'</span><span class="p">,</span> <span class="s">'type'</span><span class="p">:</span> <span class="s">'value'</span><span class="p">}]}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">time_eq</span><span class="p">(</span><span class="n">true_time</span><span class="p">,</span> <span class="n">pred_time</span><span class="p">)</span>
<span class="bp">False</span>
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
